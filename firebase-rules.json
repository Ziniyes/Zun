cat > /mnt/user-data/outputs/firebase-rules.json << 'ENDOFFILE'
{
  "rules": {
    "users": {
      "$uid": {
        ".read": "$uid === auth.uid || root.child('users').child(auth.uid).child('role').val() === 'admin'",
        ".write": "$uid === auth.uid || root.child('users').child(auth.uid).child('role').val() === 'admin'",
        ".validate": "newData.hasChildren(['email', 'displayName', 'role', 'points'])"
      }
    },
    "servers": {
      ".indexOn": ["userId", "status"],
      "$serverId": {
        ".read": "data.child('userId').val() === auth.uid || root.child('users').child(auth.uid).child('role').val() === 'admin'",
        ".write": "!data.exists() && auth != null || data.child('userId').val() === auth.uid || root.child('users').child(auth.uid).child('role').val() === 'admin'"
      }
    }
  }
}
ENDOFFILE
echo "✅ File firebase-rules.json đã tạo"
